---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout
  title="Blog - Shavkatov"
  description="Texnologiya, dasturlash va shaxsiy tajribalar haqida maqolalar"
>
  <section class="blog-page" transition:animate="fade">
    <h1>Blog</h1>

    {posts.length > 0 ? (
      <div class="posts-grid">
        {posts.map((post) => (
          <a href={`/blog/${post.id.replace(/\.md$/, '')}`} class="post-card">
            <h3 class="post-title" data-uz={post.data.title} data-en={post.data.title_en || post.data.title}>{post.data.title}</h3>
            {post.data.description && (
              <h4 class="post-description" data-uz={post.data.description} data-en={post.data.description_en || post.data.description}>{post.data.description}</h4>
            )}
          </a>
        ))}
      </div>
    ) : (
      <p class="no-posts" id="noPosts">Hozircha maqolalar yo'q.</p>
    )}
  </section>
</BaseLayout>

<script>
  const setLang = (lang: string) => {
    document.querySelectorAll('.post-title').forEach((el) => {
      const e = el as HTMLElement;
      e.textContent = lang === 'en' ? e.dataset.en! : e.dataset.uz!;
    });
    document.querySelectorAll('.post-description').forEach((el) => {
      const e = el as HTMLElement;
      e.textContent = lang === 'en' ? e.dataset.en! : e.dataset.uz!;
    });
    const noPosts = document.getElementById('noPosts');
    if (noPosts) noPosts.textContent = lang === 'en' ? 'No posts yet.' : 'Hozircha maqolalar yo\'q.';
  };
  setLang(localStorage.getItem('lang') || 'uz');
  document.addEventListener('langchange', (e: any) => setLang(e.detail));
</script>

<style>
  .blog-page {
    padding: 0.5rem 0;
  }

  .blog-page h1 {
    margin-bottom: 2rem;
    color: #888888;
  }

  .posts-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
  }

  .post-card {
    display: block;
    padding: 1.25rem 1.5rem;
    border: 1px solid #767676;
    border-radius: 10px;
    background: #000000;
    transition: border-color 0.2s ease, background 0.2s ease;
    text-decoration: none;
  }

  .post-card:hover {
    border-color: #dddddd;
    background: #000000;
  }

  .post-title {
    font-size: 1.1rem;
    font-weight: 500;
    color: #888888;
    margin: 0 0 0.5rem;
    line-height: 1.4;
    height: calc(1.1rem * 1.4);
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .post-card:hover .post-title,
  .post-card:hover .post-description {
    color: #dddddd;
  }

  .post-description {
    color: #888888;
    font-size: 0.85rem;
    margin: 0;
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .no-posts {
    color: var(--color-secondary);
  }

  @media (max-width: 640px) {
    .blog-page {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .blog-page h1 {
      width: 95%;
      text-align: left;
    }

    .posts-grid {
      width: 95%;
    }
  }
</style>
